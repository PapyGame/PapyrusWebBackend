<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<title>Diagram Specifier</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
/*! Stylesheet for CodeRay to loosely match GitHub themes | MIT License */
pre.CodeRay{background:#f7f7f8}
.CodeRay .line-numbers{border-right:1px solid;opacity:.35;padding:0 .5em 0 0;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
.CodeRay span.line-numbers{display:inline-block;margin-right:.75em}
.CodeRay .line-numbers strong{color:#000}
table.CodeRay{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.CodeRay td{vertical-align:top;line-height:inherit}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.code{padding:0 0 0 .75em}
.CodeRay .debug{color:#fff!important;background:navy!important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:navy}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:teal}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:teal}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#000}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:teal}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:teal}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_diagram_specifier">Diagram Specifier</a>
<ul class="sectlevel2">
<li><a href="#_architecture_overview">Architecture Overview</a>
<ul class="sectlevel3">
<li><a href="#_the_view_dsl">The View DSL</a></li>
<li><a href="#_the_services">The services</a></li>
<li><a href="#_tests">Tests</a></li>
</ul>
</li>
<li><a href="#_domain_definition_with_tools">Domain definition with tools</a>
<ul class="sectlevel4">
<li><a href="#_creation_tools">Creation tools</a></li>
<li><a href="#_semantic_deletion_tools">Semantic Deletion tools</a></li>
<li><a href="#_direct_edit_tools">Direct edit tools</a></li>
<li><a href="#_edge_sourcetarget_reconnection_tools">Edge source/target reconnection tools</a></li>
<li><a href="#_semantic_drag_drop_tools">Semantic drag &amp; drop tools</a></li>
<li><a href="#_graphical_drag_drop_tools">Graphical drag &amp; drop tools</a></li>
</ul>
</li>
<li><a href="#_good_practices_shared_description">Good practices: Shared Description</a>
<ul class="sectlevel3">
<li><a href="#_what_are_shared_elements">What are shared elements?</a></li>
<li><a href="#_when_should_i_use_a_shared_element">When should I use a shared element?</a></li>
<li><a href="#_tooling_around_shared_elements">Tooling around shared elements</a></li>
</ul>
</li>
<li><a href="#_domain_customization">Domain customization</a>
<ul class="sectlevel3">
<li><a href="#_custom_nodes">Custom nodes</a>
<ul class="sectlevel4">
<li><a href="#_backend">Backend</a></li>
<li><a href="#_frontend">Frontend</a></li>
</ul>
</li>
<li><a href="#_custom_tool">Custom tool</a>
<ul class="sectlevel4">
<li><a href="#_backend_2">Backend</a></li>
<li><a href="#_frontend_2">Frontend</a></li>
<li><a href="#_graphql_queries">GraphQL queries</a></li>
</ul>
</li>
<li><a href="#_add_process_before_and_after_input_handle">Add process before and after input handle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_diagram_specifier">Diagram Specifier</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_architecture_overview">Architecture Overview</h3>
<div class="paragraph">
<p>Implementing a complete diagram representation (e.g. the <em>Class Diagram</em>) involves a large amount of work. It is necessary to create the View DSL describing the representation (the nodes, edge, etc of the diagram), but also the services required by your representation, the tests, and hook your implementation into the Papyrus Web framework to make it usable by client users. In the following we describe how this code is structured.</p>
</div>
<div class="sect3">
<h4 id="_the_view_dsl">The View DSL</h4>
<div class="paragraph">
<p>While Sirius Web provides a studio to graphically create View DSLs, Papyrus Web relies on a <em>builder</em> approach to programmatically create them. This programmatic approach is motivated by the frequent evolutions of Sirius Web that are easier to capture when backed up by a robust type system instead of a graphical editor.</p>
</div>
<div class="paragraph">
<p>The code to create the View DSL of a given diagram is stored in a single class in the package <code>org.eclipse.papyrus.web.application.representations.uml</code> of the module <code>papyrus-web-representation-builder</code>. For example, the class <code>UCDDiagramDescriptionBuilder</code> contains the code to create the View DSL of the <em>Use Case</em> diagram.</p>
</div>
<div class="paragraph">
<p>These classes extend <code>AbstractRepresentationDescriptionBuilder</code>, which provides a set of utility method to create pre-configured descriptions, manipulate palette tools and tool sections, or configure direct edit capabilities (see <a href="#_how_to_create_tools">this FAQ entry</a> for more information on the best practices to create such tools).</p>
</div>
<div class="paragraph">
<p>The <code>fillDescription</code> method is the entry point of the builder. It is called by the Papyrus Web framework on startup, and typically calls other methods that are responsible for the creation of a specific element (e.g. <code>createDiagramActorDescription</code> creates the description for an <em>Actor</em> represented on the diagram background). Note that this is where you can use <a href="#_how_to_use_shared_descriptions">shared descriptions</a> to organize your builder code.</p>
</div>
<div class="paragraph">
<p>The builder is hooked into the Papyrus Web framework via the <code>PapyrusRepresentationDescriptionRegistryConfigurer</code> class in the <code>papyrus-web-application</code> module, which maps the name of the representation with the builder.</p>
</div>
</div>
<div class="sect3">
<h4 id="_the_services">The services</h4>
<div class="paragraph">
<p>Services are located in the module <code>papyrus-web-services</code>. Each diagram has its own package, which contains all the classes related to its services. As an example, the package <code>org.eclipse.papyrus.web.services.aqlservices.useCase</code> contains the code for the services of the <em>Use Case</em> diagram.</p>
</div>
<div class="paragraph">
<p>Services are used in descriptions that require complex processing, usually in their semantic candidate expression. For example, a service may be required to compute all the candidate elements of a particular description.</p>
</div>
<div class="paragraph">
<p>To call a service from the builder, you have to follow this pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">NodeDescription ucdDiagramUseCaseDescription = <span class="local-variable">this</span>.newNodeBuilder(useCaseEClass, useCaseNodeStyle)<span class="comment">//</span>
  .semanticCandidateExpression(CallQuery.queryServiceOnSelf(UseCaseDiagramServices.GET_USECASE_NODE_CANDIDATES))<span class="comment">//</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the service (i.e. the name of the method from the <code>UseCaseDiagramService</code> class) is provided as a string. Each diagram has a class that gathers the name of its services. This class is stored in the <code>papyrus-web-representation-builder</code> module, next to the builder for the View DSL.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tests">Tests</h4>
<div class="paragraph">
<p>There are two kinds of test for each diagram:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Service tests: these are unit tests ran against the services of your diagram. They are stored in <code>papyrus-web-application/src/tests/java</code>, in a dedicated package prefixed with <code>org.eclipse.papyrus.web.application.services.</code></p>
</li>
<li>
<p>Tools tests: these are integration tests that simulate tool invocation and check the state of the diagram/model returned to the frontend. They are also stored in <code>papyrus-web-application/src/test/java</code>, in a dedicated package prefixed with <code>org.eclipse.papyrus.web.application.tools.</code>. These tests are defined with the <a href="#_how_can_i_test_my_diagrams">Papyrus Web Test Framework</a>.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_definition_with_tools">Domain definition with tools</h3>
<div class="paragraph">
<p>Diagrams need to contain tool to allow the user to interact with them. A diagram can contain several kinds of tools:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node/edge creation tools</p>
</li>
<li>
<p>Node/edge deletion tools</p>
</li>
<li>
<p>Direct edit tools</p>
</li>
<li>
<p>Edge source/target reconnect tools</p>
</li>
<li>
<p>Semantic drag &amp; drop tools</p>
</li>
<li>
<p>Graphical drag &amp; drop tools</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following we detail how to create these tools in your diagram description.</p>
</div>
<div class="sect4">
<h5 id="_creation_tools">Creation tools</h5>
<div class="paragraph">
<p>The <code>ViewBuilder</code> class provides an utility method <code>createCreationTool</code> to create a Node creation tool. This method can either call the default creation process, or call a specific service if needed (e.g. if the creation is complex and requires some additional processing).</p>
</div>
<div class="paragraph">
<p>The produced <code>NodeTool</code> can be added to the diagram palette (for nodes represented on the diagram background) via the <code>AbstractRepresentationDescriptionBuilder.addDiagramToolInToolSection</code> method, or inside containing node descriptions via the <code>AbstractRepresentationDescriptionBuidler.reuseNodeAndCreateTool</code> method. Note that in both cases it is necessary to provide the name of the tool section where the tool will be added.</p>
</div>
<div class="paragraph">
<p>The <code>ViewBuilder</code> class also provides an utility method <code>createDefaultDomainBasedEdgeTool</code> to create an Edge creation tool. The produced <code>EdgeTool</code> can be added to the <strong>source</strong> nodes' palette via the <code>AbstractRepresentationDescriptionBuilder.addEdgeToolInEdgesToolSection</code> method. Note that it is necessary to provide the name of the tool section where the tool will be added.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="âš ï¸"></i>
</td>
<td class="content">
Creation tools need to be added to a <em>Tool Section</em>. You can use the <code>AbstractRepresentationDescriptionBuilder.createDefaultToolSectionInDiagramDescription</code> method to create default tool sections (<em>Nodes</em> to store node creation tools and <em>Edges</em> to store edge creation tools). This method is typically called in the <code>fillDescription</code> method of the diagram builder.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_semantic_deletion_tools">Semantic Deletion tools</h5>
<div class="paragraph">
<p>Node semantic deletion tools are typically provided via the <code>NodeDescriptionBuilder</code> used to create the node representation. The <code>ViewBuilder.createNodeDeleteTool</code> returns the default deletion tool for a given node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// In the View DSL builder</span>
<span class="local-variable">this</span>.newNodeBuilder(<span class="comment">/* ... */</span>)
  <span class="comment">// ...</span>
  .deleteTool(<span class="local-variable">this</span>.getViewBuilder().createNodeDeleteTool(domainClass.getName()))
  <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that some methods in <code>ViewBuilder</code> create fully-fledged <code>NodeDescription</code> out of the box. In this case it is not necessary to configure the deletion tool, the <code>ViewBuilder</code> takes care of it. This is for example the case for the <code>createNoteStyleUnsynchonizedNodeDescription</code> method.</p>
</div>
<div class="paragraph">
<p>Edge semantic deletion tools are pre-configured in the <code>ViewBuilder.createDefaultSynchonizedDomainBaseEdgeDescription</code> method, which is typically used to create domain-based edges.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
A description without a semantic deletion tool won&#8217;t have the <em>delete</em> tool in its palette. This may be used to forbid deletion of specific nodes on a diagram (e.g. metaclasses in the <em>Profile</em> diagram).
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_direct_edit_tools">Direct edit tools</h5>
<div class="paragraph">
<p>Direct edit tools are typically provided via the <code>NodeDescriptionBuilder</code> used to create the node representation. The <code>ViewBuilder.createDirectEditTool</code> returns the default direct edit tool for a given node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// In the View DSL builder</span>
<span class="local-variable">this</span>.newNodeBuilder(<span class="comment">/* ... */</span>)
  <span class="comment">// ...</span>
  .labelEditTool(<span class="local-variable">this</span>.getViewBuilder().createDirectEditTool(domainClass.getName()))
  <span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that some methods in <code>ViewBuilder</code> create fully-fledged <code>NodeDescription</code> out of the box. In this case it is not necessary to configure the direct edit tool, the <code>ViewBuilder</code> takes care of it. This is for example the case for the <code>createNoteStyleUnsynchonizedNodeDescription</code> method.</p>
</div>
<div class="paragraph">
<p>Edge direct edit tools are pre-configured in the <code>ViewBuilder.createDefaultSynchonizedDomainBaseEdgeDescription</code> method, which is usually used to create domain-based edges.</p>
</div>
</div>
<div class="sect4">
<h5 id="_edge_sourcetarget_reconnection_tools">Edge source/target reconnection tools</h5>
<div class="paragraph">
<p>Edge reconnection tools can be configured via the <code>ViewBuilder.addDefaultReconnectionTools</code>, which sets the default source/target reconnection tools for a given edge.</p>
</div>
<div class="paragraph">
<p>If a non-default tool is required, this can be done by editing the edge palette and adding a custom reconnection tool, which can be created with <code>ViewBuilder.createDomainBaseEdgeSourceReconnectionTool</code> and <code>ViewBuilder.createDomainBaseEdgeTargetReconnectionTool</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">SourceEdgeEndReconnectionTool tool = edge.getPalette().getEdgeReconnectionTools().add(getViewBuilder().createDomainBaseEdgeSourceReconnectionTool(edge, getIdBuilder().getSourceReconnectionToolId(edge)));</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_semantic_drag_drop_tools">Semantic drag &amp; drop tools</h5>
<div class="paragraph">
<p>The semantic drag &amp; drop tool is configured at the diagram level. This is typically done in the <code>fillDescription method</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">diagramDescription.getPalette().setDropTool(<span class="local-variable">this</span>.getViewBuilder().createGenericSemanticDropTool(<span class="local-variable">this</span>.getIdBuilder().getDiagramSemanticDropToolName()));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will automatically bind the semantic drag &amp; drop tool to the <code>SemanticDropBehaviorProvider</code> associated to the diagram, and located in the <code>papyrus-web-services</code> module.</p>
</div>
</div>
<div class="sect4">
<h5 id="_graphical_drag_drop_tools">Graphical drag &amp; drop tools</h5>
<div class="paragraph">
<p>Graphical drag &amp; drop tools have to be configured for each container nodes as well as the diagram. The configuration of the tool is similar in both cases: the graphical drag &amp; drop tool is created via the <code>ViewBuilder</code>, then the <em>accepted types</em> (i.e. the types that can be dropped on the container) are set on the tool. Finally the tool is added to the node&#8217;s (or diagram&#8217;s) palette.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// Create the drop tool</span>
DropNodeTool graphicalDropTool = <span class="local-variable">this</span>.getViewBuilder().createGraphicalDropTool(<span class="local-variable">this</span>.getIdBuilder().getDiagramGraphicalDropToolName());
<span class="comment">// Configure the accepted types</span>
<span class="predefined-type">List</span>&lt;EClass&gt; children = <span class="predefined-type">List</span>.of(<span class="local-variable">this</span>.umlPackage.getComment(), <span class="local-variable">this</span>.umlPackage.getConstraint());
<span class="local-variable">this</span>.registerCallback(diagramDescription, () -&gt; {
    <span class="comment">// Set the accepted types in the tool</span>
    <span class="predefined-type">List</span>&lt;NodeDescription&gt; droppedNodeDescriptions = <span class="local-variable">this</span>.collectNodesWithDomainAndFilter(diagramDescription, children, <span class="predefined-type">List</span>.of());
    ucdGraphicalDropTool.getAcceptedNodeTypes().addAll(droppedNodeDescriptions);
});
<span class="comment">// Add the tool to the palette</span>
diagramDescription.getPalette().setDropNodeTool(ucdGraphicalDropTool);</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_how_to_create_multiple_nested_views">How to create multiple nested views?</h6>
<div class="paragraph">
<p>The <code>IViewHelper</code> API focuses on the creation of individual graphical elements. It allows to create root element, child elements, but these methods do not handle the creation of entire sub-trees of elements.</p>
</div>
<div class="paragraph">
<p>Creating such sub-trees is complex because each view creation needs to access the graphical parent of the view to create. These graphical parents aren&#8217;t available when creating a sub-tree, because they haven&#8217;t been created yet.</p>
</div>
<div class="paragraph">
<p>This can be tackled with <code>IViewHelper.createFakeNode</code>, which creates a fake graphical node (i.e. a node that won&#8217;t be rendered by the frontend) that allows to create multiple view levels. This method is used, as an example, in the <code>GraphicalDropSwitch</code>, to create the child views of a dropped node.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_good_practices_shared_description">Good practices: Shared Description</h3>
<div class="sect3">
<h4 id="_what_are_shared_elements">What are shared elements?</h4>
<div class="paragraph">
<p>Shared elements are a reuse mechanism we use to avoid the duplication of NodeDescription in our DSL View. They are defined in a <code>SHARED_DESCRIPTIONS</code> NodeDescription, and are reused by all the descriptions that can contain them.</p>
</div>
<div class="paragraph">
<p>This mechanism ensures that a NodeDescription is defined at a single place, which eases the maintenance and evolution of the DSL View.</p>
</div>
<div class="paragraph">
<p>Note that some diagrams contain top-level NodeDescriptions in addition to shared elements to represent elements on the diagram background. These top-level NodeDescriptions typically cannot be reused from the <code>SHARED_DESCRIPTIONS</code> because their semantic candidate expression is different.</p>
</div>
</div>
<div class="sect3">
<h4 id="_when_should_i_use_a_shared_element">When should I use a shared element?</h4>
<div class="paragraph">
<p>The rules below cover the use cases where a shared element should be used to avoid code duplication.
1. A shared element is reused by <strong>at least</strong> two other elements (as child node or border node). Note that being reused by the diagram itself doesn&#8217;t count.
2. A non-shared element cannot be reused by another element
3. A shared element is suffixed with <code>_SHARED</code> and stored in a common <code>SHARED_DESCRIPTIONS</code> NodeDescription at the root of the DSL view.
4. The <code>SHARED_DESCRIPTIONS</code> NodeDescription targets the <code>UML#Element</code> metaclass as its semantic domain.
5. The <code>SHARED_DESCRIPTIONS</code> NodeDescription doesn&#8217;t contain tools.
6. The <code>SHARED_DESCRIPTIONS</code> NodeDescription has the following semantic candidate expression: <code>aql:Sequence{}</code> to make sure it is never displayed.
7. Elements that are used in a single location (e.g. elements inside a Package that cannot be represented anywhere else) should be defined inside their containing element (and not the shared description)
  - If they are reused in another location (e.g. elements inside a Package and a Profile) they should be defined as shared elements.
8. Shared elements' <code>semanticCandidateExpression</code> should never use <code>QueryBuilder#getAllReachable</code>. It should instead contain a semantic expression based on the container, or a call to a service if the semantic candidate expression is complex.</p>
</div>
<div class="paragraph">
<p><strong>These rules are validated during the build of Papyrus Web.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_tooling_around_shared_elements">Tooling around shared elements</h4>
<div class="ulist">
<ul>
<li>
<p>Use <code>AbstractRepresentationDescriptionBuilder#createSharedDescription</code> to create a shared description for a given diagram. This method takes care of the naming of the shared description, setting its semantic domain, and its semantic candidate expression (rules 4, 5, and 6).</p>
</li>
<li>
<p>Use <code>AbstractRepresentationDescriptionBuilder#createCommentDescriptionInNodeDescription</code> and <code>AbstractRepresentationBuilder#createConstraintDescriptionInNodeDescription</code> to create constraints and comments in the shared description passed as a parameter (rules 3, 8).</p>
</li>
<li>
<p>Comments and constraints can be represented in various containers in most diagrams. These methods provide a common implementation that can be reused as is in new diagrams.</p>
</li>
<li>
<p>Use <code>IdBuilder.getSpecializedDomainNodeName(eClass, AbstractRepresentationDescriptionBuilder.SHARED_SUFFIX)</code> to create a node description with the <code>_SHARED</code> suffix (rule 3).</p>
</li>
<li>
<p>Use <code>sharedDescriptionNode.getChildrenDescriptions().add(myNodeDescription)</code> to add a NodeDescription to the <code>SHARED_DESCRIPTIONS</code> element. This NodeDescription can be created with the regular creation APIs such as <code>org.eclipse.papyrus.web.application.representations.uml.AbstractRepresentationDescriptionBuilder.newNodeBuilder(EClass, NodeStyleDescription)</code>. In this case it&#8217;s the user&#8217;s responsibility to ensure that the NodeDescription complies with the rules defined above.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_domain_customization">Domain customization</h3>
<div class="sect3">
<h4 id="_custom_nodes">Custom nodes</h4>
<div class="paragraph">
<p>Custom nodes are project-specific node styles used to extend Sirius Web&#8217;s default styles. In Papyrus Web, they are typically used to define nodes with specific shapes, such as the <em>Package</em> node or the <em>Note</em> node.</p>
</div>
<div class="paragraph">
<p>Custom nodes are defined both in the backend (to make them usable in the View DSL) and the frontend (the actual graphical implementation of the node).</p>
</div>
<div class="sect4">
<h5 id="_backend">Backend</h5>
<div class="paragraph">
<p>There are two backend modules related to custom nodes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>papyrus-web-customnodes</code></p>
</li>
<li>
<p><code>papyrus-web-customnodes-edit</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To create a new custom node, open the <code>papyrus-customnodes.ecore</code> model and create a new top-level <code>EClass</code>. Set its name with the name of your custom node (e.g. <em>NoteNodeStyleDescription</em>), and set the super type to <code>NodeStyleDescription</code>. Then head to the <code>papyrus-customnodes.genmodel</code> file and re-generate the model and edit projects.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
<div class="title">Update the icon associated to the custom node in Papyrus Studio</div>
<div class="paragraph">
<p>You can update the icon associated to your custom node by creating a custom item provider in <code>papyrus-web-customnodes-edit/src/main/java</code>. This item provider has to extend the generated one. You then need to update the  <code>PapyrusCustomNodesItemProviderAdapterFactoryCustomImpl</code> class to make sure the new item provider is used by the framework.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now you need to define the custom node style and its provider in the <code>papyrus-web-application</code>. To do so, head to the <code>org.eclipse.papyrus.web.application.nodes</code> package, and create two classes for your custom node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MyCustomNodeStyle</code>: defines the parameters required by your custom node style. Typical parameters include <em>border color</em>, <em>border size</em>, or <em>color</em>, for example. Note that you can add any parameter you need (for example an image URL). These parameters will be passed to the frontend component that handles the rendering of the custom node.</p>
</li>
<li>
<p><code>MyCustomNodeStyleProvider</code>: defines the provider of your custom node. This is the class that hooks your custom node into the Sirius Web framework.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Finally, you need to update the GraphQL schema to make sure the new custom node is correctly sent to the frontend. To do so open the <code>customnodes.graphqls</code> file located in <code>papyrus-web-application</code>, and add the following content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphqls">extend union INodeStyle = MyCustomNodeStyle

type MyCustomNodeStyle {
  borderColor: String!
  borderSize: Int!
  borderStyle: LineStyle!
  imageURL: String!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the GraphQL type <strong>must</strong> match the name of the class defined in <code>org.eclipse.papyrus.web.application.nodes</code>, and the type parameters must also match the parameters of the class.</p>
</div>
<div class="paragraph">
<p><em>Optional</em>: you can add a method in <code>ViewBuilder</code> to ease the creation of your custom style. This is particularly useful when your custom node needs some specific initialization. The code bellow shows such method for the <code>NoteNodeStyle</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// [ViewBuilder.java]</span>
<span class="directive">public</span> NoteNodeStyleDescription createNoteNodeStyle() {
    NoteNodeStyleDescription nodeStyle = PapyrusCustomnodesFactory.eINSTANCE.createNoteNodeStyleDescription();
    <span class="local-variable">this</span>.initStyle(nodeStyle);
    nodeStyle.setShowIcon(<span class="predefined-constant">true</span>);
    <span class="keyword">return</span> nodeStyle;
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_frontend">Frontend</h5>
<div class="paragraph">
<p>Custom nodes are located in the <code>sirius-web-application/src/nodes</code> directory in the frontend. Each node is defined in a dedicated directory that contains 4 files:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MyCustomNode.tsx</code>: the actual implementation of the graphical node. This is where you create the React component that will be rendered to represent your node.</p>
</li>
<li>
<p><code>MyCustomNode.types.ts</code>: the types used by your custom node. This file contains both the properties required by <code>MyCustomNode.tsx</code> as well as the definition of the GraphQL type associated to your node.</p>
</li>
<li>
<p><code>MyCustomNodeConverterHandler.ts</code>: the converter that transforms the GraphQL type to your node. This is the place where you can access the styles defined in your GraphQL type and use them to instantiate your node.</p>
</li>
<li>
<p><code>MyCustomNodeLayoutHandler.ts</code>: the layout of your node. This file defines high-level layout such as how child elements are handled.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
The <code>sirius-web-application/src/nodes</code> directory contains various examples of custom nodes used in Papyrus Web.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In addition to the files defining the custom node themselves, you need to edit the file <code>sirius-web-application/src/views/edit-project/EditProjectView</code> and update the <code>nodeTypeRegistryValue</code> variable to make your custom node usable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">const nodeTypeRegistryValue: NodeTypeContextValue = {
      graphQLNodeStyleFragments: [
        // Other Node Styles already registered
        {
          type: 'MyCustomNodeStyle',
          fields: `borderColor borderSize borderStyle color`,
        },
      ],
      nodeLayoutHandlers: [
        // Other Node Layout Handlers
        new MyCustomNodeLayoutHandler(),
      ],
      nodeConverterHandlers: [
        // Other Node Converter Handlers
        new MyCustomNodeConverterHandler(),
      ],
      nodeTypeContributions: [
        // Other NodeTypeContributions
        &lt;NodeTypeContribution component={NoteNode} type={'myCustomNode'} /&gt;,
      ],
    };</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>fields</code> attribute configures the information passed by the backend that can be retrieved in your custom node implementation. In our example we provide typical attributes that are shared by most of the nodes: <code>borderColor</code>, <code>borderSize</code>, <code>borderStyle</code>, and <code>color</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
Additional information on how to create custom nodes is available in the <a href="https://github.com/eclipse-sirius/sirius-web/blob/master/doc/how-to/contribute-custom-node.adoc">Sirius Web documentation</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_tool">Custom tool</h4>
<div class="paragraph">
<p>Custom tools are used to add capabilities to a diagram that aren&#8217;t supported by the default tools. These custom tools can perform complex semantic and graphical operations, open dialogs to ease the creation of elements, etc.</p>
</div>
<div class="paragraph">
<p>Since these tools are diagram-specific, they require some work on the backend and the frontend of Papyrus Web. In the following we show how to create such custom tool, using the <em>Import Metaclass</em> popup from the Profile diagram as an example.</p>
</div>
<div class="sect4">
<h5 id="_backend_2">Backend</h5>
<div class="sect5">
<h6 id="_graphql">GraphQL</h6>
<div class="paragraph">
<p>When a tool is executed on a diagram, a GraphQL query is sent to the backend to perform the actual operation on the graphical and semantic model.</p>
</div>
<div class="paragraph">
<p>Sirius Web tools notify the backend through GraphQL mutations. Custom tools do the same, but the mutation they send need to be specified in the backend. This is done in a <code>profile.graphqls</code> file from the <code>papyrus-web-graphql</code> module.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For now we only have a <code>profile.graphqls</code> file in this module, because we only have custom tools on profile diagram. Additional files can be created for future diagrams if necessary.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphqls">extend type Mutation {
  // [Other mutations]
  createMetaclassImport(input: CreateMetaclassImportInput): CreateMetaclassImportPayload
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The new mutation consumes a <code>CreateMetaclassImportInput</code> input and produces a <code>CreateMetaclassImportPayload</code> result. We have to specify them in the <code>graphqls</code> file too:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="graphqls">input CreateMetaclassImportInput {
        id: ID!
        editingContextId: ID!
        representationId: ID!
        diagramElementId: ID!
        metaclassIds: [ID!]!
}

union CreateMetaclassImportPayload = ErrorPayload | CreateMetaclassImportSuccessPayload

type CreateMetaclassImportSuccessPayload {
        id: ID!
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>CreateMetaclassImportInput</code> type specifies the information that will be sent from the frontend to perform the operation (in our case create a metaclass import). The <code>id</code> is a mandatory field used to identify the input, the other fields specify the editing context, the current representation (the diagram), the selected element when the tool is invoked, and the list of metaclasses to create.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We won&#8217;t detail here how this list of metaclass is computed by the frontend. See <a href="#_graphql_queries">GraphQL Queries</a> section for more information on how to retrieve backend data from the frontend.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>CreateMetaclassImportPayload</code> specifies that the mutation can return either an <code>ErrorPayload</code> (if something went wrong while handeling it), or a <code>CreateMetaclassImportSuccessPayload</code> that wraps the identifier of the successful mutation.</p>
</div>
<div class="paragraph">
<p>Now that we have defined the GraphQL mutation we need to define the backend DTO (Data Transfer Object) that will represent the data, as well as the fetcher and handler that will receive the mutation and execute the actual code performing the requested action.</p>
</div>
</div>
<div class="sect5">
<h6 id="_dto">DTO</h6>
<div class="paragraph">
<p>We need to create a DTO for the input and the produced payload. This is done in the <code>papyrus-web-services-api</code> module, in the <code>org.eclipse.papyrus.web.services.api.dto</code> package. We create the following two classes/records:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// File: CreateMetaclassImportInput.java</span>
<span class="directive">public</span> record CreateMetaclassImportInput(
  <span class="predefined-type">UUID</span> id,
  <span class="predefined-type">String</span> editingContextId,
  <span class="predefined-type">String</span> representationId,
  <span class="predefined-type">String</span> diagramElementId,
  <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; metaclassIds) <span class="directive">implements</span> IDiagramInput {

}
<span class="comment">// File CreateMetaclassImportSuccessPayload.java</span>
<span class="directive">public</span> <span class="directive">final</span> <span class="type">class</span> <span class="class">CreateMetaclassImportSuccessPayload</span> <span class="directive">implements</span> IPayload {

    <span class="directive">private</span> <span class="directive">final</span> <span class="predefined-type">UUID</span> id;

    <span class="directive">public</span> CreateMetaclassImportSuccessPayload(<span class="predefined-type">UUID</span> id) {
        <span class="local-variable">this</span>.id = Objects.requireNonNull(id);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">UUID</span> id() {
        <span class="keyword">return</span> <span class="local-variable">this</span>.id;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="predefined-type">String</span> pattern = <span class="string"><span class="delimiter">&quot;</span><span class="content">{0} '{'id: {1}'}'</span><span class="delimiter">&quot;</span></span>;
        <span class="keyword">return</span> <span class="predefined-type">MessageFormat</span>.format(pattern, <span class="local-variable">this</span>.getClass().getSimpleName(), <span class="local-variable">this</span>.id);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key part here is that the <code>CreateMetaclassImportInput</code> record takes as parameters the fields of the <code>CreateMetaclassImportInput</code> GraphQL input.</p>
</div>
</div>
<div class="sect5">
<h6 id="_data_fetcher">Data Fetcher</h6>
<div class="paragraph">
<p>We now have to define the <em>data fetcher</em> that will receive the GraphQL mutation. This is done in the <code>papyrus-web-graphql</code> module, in the <code>org.eclipse.papyrus.web.graphql.datafetchers.mutation</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@MutationDataFetcher</span>(type = <span class="string"><span class="delimiter">&quot;</span><span class="content">Mutation</span><span class="delimiter">&quot;</span></span>, field = MutationCreateMetaclassImportDataFetcher.CREATE_METACLASS_IMPORT_FIELD)
<span class="directive">public</span> <span class="type">class</span> <span class="class">MutationCreateMetaclassImportDataFetcher</span> <span class="directive">implements</span> IDataFetcherWithFieldCoordinates&lt;CompletableFuture&lt;IPayload&gt;&gt; {

  <span class="directive">public</span> <span class="directive">static</span> <span class="directive">final</span> <span class="predefined-type">String</span> CREATE_METACLASS_IMPORT_FIELD = <span class="string"><span class="delimiter">&quot;</span><span class="content">createMetaclassImport</span><span class="delimiter">&quot;</span></span>;

  <span class="comment">// Attributes and constructor</span>

  <span class="annotation">@Override</span>
    <span class="directive">public</span> CompletableFuture&lt;IPayload&gt; get(DataFetchingEnvironment environment) <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="predefined-type">Object</span> argument = environment.getArgument(<span class="string"><span class="delimiter">&quot;</span><span class="content">input</span><span class="delimiter">&quot;</span></span>);
        <span class="type">var</span> input = <span class="local-variable">this</span>.objectMapper.convertValue(argument, CreateMetaclassImportInput.class);

        <span class="keyword">return</span> <span class="local-variable">this</span>.editingContextEventProcessorRegistry.dispatchEvent(input.editingContextId(), input)
                .defaultIfEmpty(<span class="keyword">new</span> ErrorPayload(input.id(), <span class="local-variable">this</span>.messageService.unexpectedError()))
                .toFuture();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data fetcher is bound to the mutation using the <code>@MutationDataFetcher</code> annotation. The important part here is the <code>get</code> method, that dispatches the event to the processors, and returns an <code>ErrorPayload</code> if no result was returned.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
Data fetchers are only required for mutations. You don&#8217;t need to create a fetcher for queries, they are directly forwarded to the event processor.
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_event_handler">Event Handler</h6>
<div class="paragraph">
<p>Now we can define the event handler that will be used by the event processor to actually perform the backend logic associated to the mutation. This is done in the <code>papyrus-web-services</code> module, in the <code>org.eclipse.papyrus.web.services.editingcontext.handlers</code> package.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// File CreateMetaclassImportHandler.java</span>
<span class="annotation">@Service</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">CreateMetaclassImportEventHandler</span> <span class="directive">implements</span> IDiagramEventHandler {

    <span class="comment">// Attributes and constructor</span>

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> canHandle(IDiagramInput input) {
        <span class="keyword">return</span> input <span class="keyword">instanceof</span> CreateMetaclassImportInput;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> handle(One&lt;IPayload&gt; payloadSink, Many&lt;ChangeDescription&gt; changeDescriptionSink, IEditingContext editingContext, IDiagramContext diagramContext, IDiagramInput diagramInput) {
        <span class="local-variable">this</span>.counter.increment();

        ChangeDescription changeDescription = <span class="keyword">new</span> ChangeDescription(ChangeKind.NOTHING, editingContext.getId(), diagramInput);
        IPayload payload = <span class="predefined-constant">null</span>;

        <span class="directive">final</span> <span class="predefined-type">String</span> message;
        <span class="keyword">if</span> (diagramInput <span class="keyword">instanceof</span> CreateMetaclassImportInput createMetaclassImportInput) {
            <span class="predefined-type">String</span> representationId = createMetaclassImportInput.representationId();
            <span class="predefined-type">String</span> diagramElementId = createMetaclassImportInput.diagramElementId();
            <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; metaclassIds = createMetaclassImportInput.metaclassIds();

            <span class="type">boolean</span> result = <span class="predefined-constant">true</span>;
            <span class="keyword">for</span> (<span class="predefined-type">String</span> metaclassId : metaclassIds) {
                result = result &amp;&amp; <span class="local-variable">this</span>.profileDiagramService.createMetaclassImport(editingContext, representationId, diagramElementId, metaclassId, diagramContext);
            }
            <span class="keyword">if</span> (result) {
                payload = <span class="keyword">new</span> CreateMetaclassImportSuccessPayload(createMetaclassImportInput.id());
                changeDescription = <span class="keyword">new</span> ChangeDescription(ChangeKind.SEMANTIC_CHANGE, editingContext.getId(), createMetaclassImportInput);
                message = <span class="predefined-constant">null</span>;
            } <span class="keyword">else</span> {
                changeDescription = <span class="keyword">new</span> ChangeDescription(ChangeKind.SEMANTIC_CHANGE, editingContext.getId(), createMetaclassImportInput);
                message = <span class="string"><span class="delimiter">&quot;</span><span class="content">The metaclass import creation failed</span><span class="delimiter">&quot;</span></span>;
            }
        } <span class="keyword">else</span> {
            message = <span class="local-variable">this</span>.messageService.invalidInput(diagramInput.getClass().getSimpleName(), ApplyProfileInput.class.getSimpleName());
        }

        <span class="keyword">if</span> (payload == <span class="predefined-constant">null</span>) {
            payload = <span class="keyword">new</span> ErrorPayload(diagramInput.id(), message);
        }

        payloadSink.tryEmitValue(payload);
        changeDescriptionSink.tryEmitNext(changeDescription);
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>canHandle</code> method let the event processor know if the handler can handle a specific input. The <code>handle</code> method is where we actually perform the operation. In our example this is done by calling <code>profileDiagramService.createMetaclassImport</code>. If the operation is successful the handler constructs a <code>CreateMetaclassImportSuccessPayload</code> to notify the caller. A <code>ChangeDescription</code> is also created to represent the modification performed by the handler. This <code>ChangeDescription</code> is forwarded to the other event processors, which can trigger additional operations based on the change (e.g. refresh the diagram, create a view, etc).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
Our handler implements <code>IDiagramEventHandler</code> because it performs both semantic and graphical operations (the import metaclass is created in the model, and the corresponding view is added on the diagram). Handlers that only perform semantic operation should implement <code>IEditingContextEventHandler</code>, which doesn&#8217;t provide an access to the <code>DiagramContext</code>, making graphical operations impossible to perform.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_frontend_2">Frontend</h5>
<div class="paragraph">
<p>On the frontend side, a custom tool is a React component that is added in the palette. This component takes a <code>DiagramPaletteToolContributionComponentProps</code> as parameter, and sends the GraphQL mutation to the backend. The file <code>PapyrusPopupToolContribution</code> shows such component for our <em>Import Metaclass</em> example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">const createMetaclassImportMutation = gql`
  mutation createMetaclassImport($input: CreateMetaclassImportInput!) {
    createMetaclassImport(input: $input) {
      __typename
      ... on ErrorPayload {
        message
      }
    }
  }
`;

export const PapyrusPopupToolContribution = ({ diagramElementId }: DiagramPaletteToolContributionComponentProps) =&gt; {
  // ...

  const [createMetaclassImport, { data, error }] = useMutation&lt;
    GQLCreateMetaclassImportData,
    GQLCreateMetaclassImportVariables
  &gt;(createMetaclassImportMutation);
  useEffect(() =&gt; {
    if (error) {
      addErrorMessage(error.message);
    }
    if (data &amp;&amp; data.createMetaclassImport.__typename === 'ErrorPayload') {
      const errorPayload = data.createMetaclassImport as ErrorPayload;
      addErrorMessage(errorPayload.message);
    }
  }, [data, error, onClose]);

  // ...
  const variables: GQLCreateMetaclassImportVariables = {
      input: {
        id: crypto.randomUUID(),
        editingContextId,
        representationId,
        diagramElementId,
        metaclassIds: selectedElementIds,
      },
    };
    createMetaclassImport({ variables });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The details of the component are ommitted for the sake of simplicity. Note that the component can perform complex operations such as opening a dialog to retrieve the parameters required to send the mutation to the backend. The GraphQL types manipulates by the component are defined in a dedicated file (<code>PapyrusPopupToolContribution.types.ts</code> in our example).</p>
</div>
<div class="paragraph">
<p>Finally, we need to edit the <code>EditProjectViews.tsx</code> file to add our new tool contribution. This is done in the <code>diagramPaletteToolContributions</code> variables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="typescript">const diagramPaletteToolContributions: DiagramPaletteToolContextValue = [
      &lt;DiagramPaletteToolContribution
        canHandle={(_diagramId, diagramElementId) =&gt; {
          if (!isProfileDiagram) {
            return false;
          }
          if (_diagramId === diagramElementId) {
            return true;
          } else {
            const nodes = useNodes&lt;NodeData&gt;();
            const targetedNode = nodes.find((node) =&gt; node.id === diagramElementId);
            return targetedNode?.data.targetObjectKind === 'siriusComponents://semantic?domain=uml&amp;entity=Profile';
          }
        }}
        component={PapyrusPopupToolContribution}
      /&gt;,
    ];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>canHandle</code> function allows to configure where/when the custom tool should be displayed. In our example we want to allow metaclass import only on profile elements and on the background of the diagram. The component parameter is set with the react component we created above.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
Additional information on how to contribute custom tools to a diagram is available on the <a href="https://github.com/eclipse-sirius/sirius-web/blob/master/doc/how-to/contribute-custom-tool.adoc">Sirius Web documentation</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_graphql_queries">GraphQL queries</h5>
<div class="paragraph">
<p>GraphQL queries are sent by the frontend to access data from the backend. As an example, a GraphQL query (<code>getMetaclassMetadatas</code>) is used by the <code>PapyrusPopupToolContribution</code> to retrieve all the metaclasses available in the editing context.</p>
</div>
<div class="paragraph">
<p>These queries are defined in a similar way mutations are, with backend DTOs and event handlers. Note that queries does not need a <em>data fetcher</em>, they are directly handled by the event handlers.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_add_process_before_and_after_input_handle">Add process before and after input handle</h4>
<div class="paragraph">
<p>Developer has the capacity to make programmatically some actions before and after the input processing. These actions can make some semantic changes.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="ðŸ’¡"></i>
</td>
<td class="content">
Input is extracted from the request sent by the frontend.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For example, the pre-process should be able to change the input. This is the case on Communication and Activity diagrams. User can launch diagram creation on the root <em>Model</em> and the created diagram is linked to an intermediate created semantic element (an <em>Interaction</em> or an <em>Activity</em>) instead of the input <em>Model</em> .</p>
</div>
<div class="paragraph">
<p>Two interfaces are available to define actions before or after input processing : <code>IInputPreProcessor</code> and <code>IOutputPreProcessor</code>.
If developers want to define some action before input processing, they should create a service class (with tag <code>@Service</code>) that implements <code>IInputPreProcessor</code> interface and then fill the <code>preProcess</code> method.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2024-03-26 19:02:54 +0100
</div>
</div>
</body>
</html>